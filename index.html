<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨èº«æ³•ç®¡ç†ã‚¢ãƒ—ãƒª</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .quote-fade {
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <header class="bg-white rounded-lg shadow-md p-6 mb-4">
            <div class="text-center">
                <h1 class="text-3xl font-bold text-gray-800 mb-3">
                    <i class="fas fa-dumbbell text-blue-600"></i>
                    å…¨èº«æ³•ç®¡ç†
                </h1>
                <div class="text-lg font-semibold text-gray-700" id="currentDate"></div>
            </div>
        </header>

        <!-- Daily Quote Section -->
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg shadow-md p-6 mb-6 text-white quote-fade">
            <div class="flex items-center justify-center text-center">
                <div>
                    <i class="fas fa-quote-left text-2xl mb-3 opacity-70"></i>
                    <blockquote class="text-lg font-medium mb-2" id="dailyQuote">
                        <!-- åè¨€ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </blockquote>
                    <cite class="text-sm opacity-80" id="quoteAuthor">
                        <!-- ä½œè€…ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </cite>
                    <i class="fas fa-quote-right text-2xl mt-3 opacity-70 block"></i>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <nav class="flex">
                <button onclick="showTab('training')" id="trainingTab" class="tab-button flex-1 py-4 px-6 text-center font-semibold text-blue-600 border-b-2 border-blue-600">
                    <i class="fas fa-play-circle mr-2"></i>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
                </button>
                <button onclick="showTab('history')" id="historyTab" class="tab-button flex-1 py-4 px-6 text-center font-semibold text-gray-500">
                    <i class="fas fa-history mr-2"></i>å±¥æ­´
                </button>
                <button onclick="showTab('stats')" id="statsTab" class="tab-button flex-1 py-4 px-6 text-center font-semibold text-gray-500">
                    <i class="fas fa-chart-line mr-2"></i>çµ±è¨ˆãƒ»ã‚°ãƒ©ãƒ•
                </button>
            </nav>
        </div>

        <!-- Training Tab -->
        <div id="trainingContent" class="tab-content">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 space-y-3 sm:space-y-0">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
                        <p class="text-sm text-gray-500 mt-1">ğŸ’¡ é‡é‡ã¯å‰å›ã®è¨˜éŒ²ã‹ã‚‰è‡ªå‹•è¨­å®šã•ã‚Œã¾ã™</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="resetWeights()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition duration-200">
                            <i class="fas fa-weight-hanging mr-2"></i>é‡é‡ãƒªã‚»ãƒƒãƒˆ
                        </button>
                        <button onclick="resetToday()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-200">
                            <i class="fas fa-redo mr-2"></i>å…¨ãƒªã‚»ãƒƒãƒˆ
                        </button>
                    </div>
                </div>
                
                <div class="grid gap-4" id="exerciseList"></div>
                
                <div class="mt-6 text-center">
                    <button onclick="completeWorkout()" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-lg font-semibold transition duration-200">
                        <i class="fas fa-check-circle mr-2"></i>ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆå®Œäº†
                    </button>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="historyContent" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å±¥æ­´</h2>
                <div class="flex flex-col sm:flex-row gap-2 mb-4">
                    <input type="date" id="historyDate" class="border rounded-lg px-3 py-2 flex-1">
                    <button onclick="showHistoryForDate()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-search mr-2"></i>æ¤œç´¢
                    </button>
                </div>
                <div id="historyDisplay"></div>
            </div>
        </div>

        <!-- Stats Tab -->
        <div id="statsContent" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- çµ±è¨ˆæƒ…å ± -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-chart-bar mr-2"></i>çµ±è¨ˆæƒ…å ±
                    </h2>
                    <div id="statsInfo"></div>
                </div>

                <!-- é€²æ—ã‚°ãƒ©ãƒ• -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-chart-line mr-2"></i>é‡é‡æ¨ç§»
                    </h2>
                    <div style="height: 300px;">
                        <canvas id="weightChart"></canvas>
                    </div>
                </div>

                <!-- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é »åº¦ -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-calendar-alt mr-2"></i>æœˆé–“ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å›æ•°
                    </h2>
                    <div style="height: 300px;">
                        <canvas id="frequencyChart"></canvas>
                    </div>
                </div>

                <!-- éƒ¨ä½åˆ¥çµ±è¨ˆ -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-user mr-2"></i>éƒ¨ä½åˆ¥å®Œäº†ç‡
                    </h2>
                    <div style="height: 300px;">
                        <canvas id="bodyPartChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Daily Quotes Database
        const dailyQuotes = [
            { quote: "ç­‹è‚‰ã¯è£åˆ‡ã‚‰ãªã„ã€‚", author: "ãªã‹ã‚„ã¾ãã‚“ã«å›" },
            { quote: "ä»Šæ—¥ã®è‡ªåˆ†ã¯æ˜¨æ—¥ã®è‡ªåˆ†ã‚ˆã‚Šå¼·ããªã£ã¦ã„ã‚‹ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "é™ç•Œã¯å¿ƒã®ä¸­ã«ã ã‘å­˜åœ¨ã™ã‚‹ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "å¼·ã•ã¯ä½“ã‹ã‚‰ã§ã¯ãªã„ã€‚ä¸å±ˆã®æ„å¿—ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹ã€‚", author: "ãƒãƒãƒˆãƒãƒ»ã‚¬ãƒ³ãƒ‡ã‚£ãƒ¼" },
            { quote: "ç—›ã¿ã¯ä¸€æ™‚çš„ã ãŒã€è«¦ã‚ã‚‹ã“ã¨ã¯ä¸€ç”Ÿã®å¾Œæ‚”ã¨ãªã‚‹ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "æˆåŠŸã¨ã¯ã€æƒ…ç†±ã‚’å¤±ã†ã“ã¨ãªãå¤±æ•—ã‹ã‚‰å¤±æ•—ã‚’é‡ã­ã‚‹ã“ã¨ã§ã‚ã‚‹ã€‚", author: "ã‚¦ã‚£ãƒ³ã‚¹ãƒˆãƒ³ãƒ»ãƒãƒ£ãƒ¼ãƒãƒ«" },
            { quote: "æ˜¨æ—¥ã®è‡ªåˆ†ã‚’è¶…ãˆã‚‹ã“ã¨ãŒã€çœŸã®å‹åˆ©ã ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ç­‹è‚‰ã ã‘ã§ãªãã€å¿ƒã‚‚é›ãˆã‚ˆã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "æ±—ã¯è„‚è‚ªãŒæ³£ã„ã¦ã„ã‚‹éŸ³ã ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "å§‹ã‚ã‚‹ã“ã¨ãŒæœ€ã‚‚å›°é›£ã ã€‚ç¶šã‘ã‚‹ã“ã¨ã¯ãã®æ¬¡ã«å›°é›£ã ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "å¼·ã„äººã¯å›°é›£ã«ç«‹ã¡å‘ã‹ã†ã€‚æœ€å¼·ã®äººã¯å›°é›£ã‚’æ¥½ã—ã‚€ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ä¼‘æ¯ã¯éŒ†ã³ã§ã¯ãªã„ã€‚æˆé•·ã®ãŸã‚ã®æº–å‚™ã ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ç­‹è‚‰ã¯è¨˜æ†¶ã—ã¦ã„ã‚‹ã€‚ä»Šæ—¥ã®åŠªåŠ›ã‚’æ˜æ—¥å¿…ãšè¦šãˆã¦ã„ã‚‹ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ã‚ˆã‚Šå¤§åˆ‡ãªã®ã¯ã€ç¶šã‘ã‚‹æ„å¿—ã ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ã‚¸ãƒ ã¯ç¬¬äºŒã®å®¶ã€‚ãƒãƒ¼ãƒ™ãƒ«ã¯è¦ªå‹ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "é‡ã„ã‚‚ã®ã‚’æŒã¡ä¸Šã’ã‚‹ã®ã§ã¯ãªã„ã€‚è‡ªåˆ†è‡ªèº«ã‚’æŒã¡ä¸Šã’ã‚‹ã®ã ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ç­‹è‚‰ç—›ã¯æ˜¨æ—¥é ‘å¼µã£ãŸè¨¼æ‹ ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ç†æƒ³ã®ä½“ã¯1æ—¥ã§ã¯ä½œã‚Œãªã„ã€‚ã ãŒæ¯æ—¥ã®ç©ã¿é‡ã­ã§å¿…ãšä½œã‚Œã‚‹ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "è² è·ã‚’ã‹ã‘ãªã‘ã‚Œã°ã€æˆé•·ã¯ãªã„ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "é™ç•Œã ã¨æ€ã£ãŸæ™‚ãŒã€æœ¬å½“ã®ã‚¹ã‚¿ãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ä½“ã‚’å¤‰ãˆã‚‹åŠ›ã¯ã€äººç”Ÿã‚’å¤‰ãˆã‚‹åŠ›ã¨åŒã˜ã ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ä»Šæ—¥ã§ãã‚‹ã“ã¨ã‚’æ˜æ—¥ã«å»¶ã°ã™ãªã€‚ç­‹è‚‰ã¯å¾…ã£ã¦ãã‚Œãªã„ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "å¼·ã•ã¯é¸æŠã ã€‚æ¯æœãƒ™ãƒƒãƒ‰ã‹ã‚‰èµ·ãã‚‹æ™‚ã«é¸ã¶ã‚‚ã®ã ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "å®Œç’§ãªä½“å‹ãªã©å­˜åœ¨ã—ãªã„ã€‚å­˜åœ¨ã™ã‚‹ã®ã¯å®Œç’§ãªåŠªåŠ›ã ã‘ã ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ç­‹è‚‰ã¯æ­£ç›´ã ã€‚å˜˜ã‚’ã¤ã‹ãªã„ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ä»Šæ—¥ã®æ±—ã¯ã€æ˜æ—¥ã®è‡ªä¿¡ã«ãªã‚‹ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "é‡é‡ã¯æ•°å­—ã«éããªã„ã€‚é‡è¦ãªã®ã¯å¿ƒã®é‡ã•ã ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ä¼‘ã‚€ç†ç”±ã‚’æ¢ã™ã‚ˆã‚Šã€ç¶šã‘ã‚‹ç†ç”±ã‚’è¦‹ã¤ã‘ã‚ˆã†ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "ç­‹è‚‰ã¯24æ™‚é–“åƒã„ã¦ã„ã‚‹ã€‚æ„Ÿè¬ã‚’å¿˜ã‚Œãšã«ã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" },
            { quote: "å¼·ããªã‚ŠãŸã‘ã‚Œã°ã€å¼±ã„è‡ªåˆ†ã¨æˆ¦ãˆã€‚", author: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ ¼è¨€" }
        ];

        // Exercise data
        const exercises = [
            { name: 'ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹', bodyPart: 'èƒ¸', icon: 'fas fa-weight-hanging', defaultWeight: 60 },
            { name: 'ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³', bodyPart: 'èƒŒä¸­', icon: 'fas fa-arrows-alt-v', defaultWeight: 50 },
            { name: 'ãƒ€ãƒ³ãƒ™ãƒ«ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹', bodyPart: 'è‚©', icon: 'fas fa-dumbbell', defaultWeight: 20 },
            { name: 'ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«', bodyPart: 'ä¸Šè…•äºŒé ­ç­‹', icon: 'fas fa-dumbbell', defaultWeight: 15 },
            { name: 'ãƒ©ã‚¤ã‚¤ãƒ³ã‚°ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³', bodyPart: 'ä¸Šè…•ä¸‰é ­ç­‹', icon: 'fas fa-dumbbell', defaultWeight: 25 },
            { name: 'ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ', bodyPart: 'è¶³', icon: 'fas fa-walking', defaultWeight: 80 },
            { name: 'ã‚¯ãƒ©ãƒ³ãƒ', bodyPart: 'è…¹ç­‹', icon: 'fas fa-male', defaultWeight: 0 }
        ];

        // Application state
        let currentWorkout = {};
        let trainingHistory = JSON.parse(localStorage.getItem('trainingHistory')) || {};
        let lastWeights = JSON.parse(localStorage.getItem('lastWeights')) || {};

        // Get last used weight or default weight
        function getInitialWeight(exerciseName, defaultWeight) {
            return lastWeights[exerciseName] || defaultWeight;
        }

        // Display daily quote
        function displayDailyQuote() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const quoteIndex = dayOfYear % dailyQuotes.length;
            const todaysQuote = dailyQuotes[quoteIndex];
            
            document.getElementById('dailyQuote').textContent = todaysQuote.quote;
            document.getElementById('quoteAuthor').textContent = `- ${todaysQuote.author}`;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            displayDailyQuote();
            initializeWorkout();
            renderExercises();
        });

        function updateCurrentDate() {
            const today = new Date();
            document.getElementById('currentDate').textContent = 
                today.toLocaleDateString('ja-JP', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    weekday: 'long'
                });
        }

        // Modified initialization to use last weights
        function initializeWorkout() {
            const today = getToday();
            if (!trainingHistory[today]) {
                currentWorkout = {};
                exercises.forEach(exercise => {
                    currentWorkout[exercise.name] = {
                        weight: getInitialWeight(exercise.name, exercise.defaultWeight),
                        sets: [false, false, false],
                        completed: false
                    };
                });
            } else {
                currentWorkout = { ...trainingHistory[today] };
            }
        }

        function getToday() {
            return new Date().toISOString().split('T')[0];
        }

        function renderExercises() {
            const container = document.getElementById('exerciseList');
            container.innerHTML = '';

            exercises.forEach(exercise => {
                const exerciseData = currentWorkout[exercise.name];
                const completedSets = exerciseData.sets.filter(Boolean).length;
                const isLastWeightUsed = lastWeights[exercise.name] && lastWeights[exercise.name] !== exercise.defaultWeight;
                
                const exerciseCard = document.createElement('div');
                exerciseCard.className = `border rounded-lg p-4 ${exerciseData.completed ? 'bg-green-50 border-green-200' : 'bg-white border-gray-200'}`;
                
                exerciseCard.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <i class="${exercise.icon} text-2xl text-blue-600 mr-3"></i>
                            <div>
                                <h3 class="font-semibold text-gray-800">${exercise.name}</h3>
                                <p class="text-sm text-gray-600">${exercise.bodyPart}</p>
                                ${isLastWeightUsed ? '<p class="text-xs text-blue-500">ğŸ“ˆ å‰å›ã®é‡é‡ã‚’ä½¿ç”¨</p>' : ''}
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center mb-2">
                                <input type="number" 
                                       value="${exerciseData.weight}" 
                                       onchange="updateWeight('${exercise.name}', this.value)"
                                       class="w-16 text-center border rounded px-2 py-1 mr-1 ${isLastWeightUsed ? 'border-blue-300 bg-blue-50' : ''}">
                                <span class="text-sm text-gray-600">kg</span>
                            </div>
                            <div class="text-sm text-gray-500">${completedSets}/3 ã‚»ãƒƒãƒˆå®Œäº†</div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center space-x-2 sm:space-x-4">
                        ${exerciseData.sets.map((completed, index) => `
                            <button onclick="toggleSet('${exercise.name}', ${index})"
                                    class="px-3 py-2 sm:px-4 rounded-lg font-medium transition duration-200 text-sm sm:text-base ${
                                        completed 
                                            ? 'bg-green-500 text-white' 
                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                    }">
                                ã‚»ãƒƒãƒˆ${index + 1}
                                ${completed ? '<i class="fas fa-check ml-1"></i>' : ''}
                            </button>
                        `).join('')}
                    </div>
                    
                    <div class="mt-3">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" 
                                 style="width: ${(completedSets / 3) * 100}%"></div>
                        </div>
                    </div>
                `;
                
                container.appendChild(exerciseCard);
            });
        }

        // Modified weight update to save last weights
        function updateWeight(exerciseName, weight) {
            const newWeight = parseInt(weight) || 0;
            currentWorkout[exerciseName].weight = newWeight;
            
            // Save as last used weight
            lastWeights[exerciseName] = newWeight;
            localStorage.setItem('lastWeights', JSON.stringify(lastWeights));
            
            saveWorkout();
            renderExercises();
        }

        function toggleSet(exerciseName, setIndex) {
            currentWorkout[exerciseName].sets[setIndex] = !currentWorkout[exerciseName].sets[setIndex];
            
            // Check if all sets are completed
            const completedSets = currentWorkout[exerciseName].sets.filter(Boolean).length;
            currentWorkout[exerciseName].completed = completedSets === 3;
            
            saveWorkout();
            renderExercises();
        }

        function saveWorkout() {
            const today = getToday();
            trainingHistory[today] = { ...currentWorkout };
            localStorage.setItem('trainingHistory', JSON.stringify(trainingHistory));
        }

        // Reset weights to default
        function resetWeights() {
            if (confirm('ã™ã¹ã¦ã®é‡é‡ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                exercises.forEach(exercise => {
                    currentWorkout[exercise.name].weight = exercise.defaultWeight;
                    lastWeights[exercise.name] = exercise.defaultWeight;
                });
                localStorage.setItem('lastWeights', JSON.stringify(lastWeights));
                saveWorkout();
                renderExercises();
                alert('é‡é‡ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼');
            }
        }

        function resetToday() {
            if (confirm('ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                initializeWorkout();
                renderExercises();
                saveWorkout();
            }
        }

        function completeWorkout() {
            const completedExercises = exercises.filter(ex => currentWorkout[ex.name].completed).length;
            
            if (completedExercises === exercises.length) {
                alert('ğŸ‰ ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ä»Šæ—¥ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼');
            } else {
                const remaining = exercises.length - completedExercises;
                if (confirm(`ã¾ã ${remaining}ç¨®ç›®ãŒæœªå®Œäº†ã§ã™ã€‚ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ`)) {
                    alert('ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ä»Šæ—¥ã¯ã“ã“ã¾ã§ã«ã—ã¾ã—ã‚‡ã†ã€‚');
                }
            }
            
            saveWorkout();
        }

        // Tab functionality
        function showTab(tabName) {
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active styles from all tabs
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                button.classList.add('text-gray-500');
            });
            
            // Show selected content
            document.getElementById(tabName + 'Content').classList.remove('hidden');
            
            // Add active styles to selected tab
            const activeTab = document.getElementById(tabName + 'Tab');
            activeTab.classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
            activeTab.classList.remove('text-gray-500');
            
            // Load content based on tab
            if (tabName === 'history') {
                loadHistoryContent();
            } else if (tabName === 'stats') {
                loadStatsContent();
            }
        }

        function loadHistoryContent() {
            document.getElementById('historyDate').value = getToday();
            showHistoryForDate();
        }

        function showHistoryForDate() {
            const selectedDate = document.getElementById('historyDate').value;
            const historyDisplay = document.getElementById('historyDisplay');
            
            if (!selectedDate) {
                historyDisplay.innerHTML = '<p class="text-gray-500">æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>';
                return;
            }
            
            const dayData = trainingHistory[selectedDate];
            
            if (!dayData) {
                historyDisplay.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-calendar-times text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-500">${selectedDate}ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
                    </div>
                `;
                return;
            }
            
            let html = `<div class="space-y-4">`;
            
            exercises.forEach(exercise => {
                const exerciseData = dayData[exercise.name];
                const completedSets = exerciseData.sets.filter(Boolean).length;
                
                html += `
                    <div class="border rounded-lg p-4 ${exerciseData.completed ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <i class="${exercise.icon} text-xl text-blue-600 mr-3"></i>
                                <div>
                                    <h4 class="font-semibold">${exercise.name}</h4>
                                    <p class="text-sm text-gray-600">${exercise.bodyPart}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold">${exerciseData.weight}kg</div>
                                <div class="text-sm text-gray-500">${completedSets}/3 ã‚»ãƒƒãƒˆ</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            historyDisplay.innerHTML = html;
        }

        function loadStatsContent() {
            updateStatsInfo();
            createWeightChart();
            createFrequencyChart();
            createBodyPartChart();
        }

        function updateStatsInfo() {
            const totalDays = Object.keys(trainingHistory).length;
            const dates = Object.keys(trainingHistory).sort();
            
            let totalWorkouts = 0;
            let totalSets = 0;
            let totalWeight = 0;
            
            dates.forEach(date => {
                const dayData = trainingHistory[date];
                exercises.forEach(exercise => {
                    const exerciseData = dayData[exercise.name];
                    const completedSets = exerciseData.sets.filter(Boolean).length;
                    totalSets += completedSets;
                    totalWeight += exerciseData.weight * completedSets;
                    if (exerciseData.completed) totalWorkouts++;
                });
            });
            
            const avgWeight = totalSets > 0 ? Math.round(totalWeight / totalSets) : 0;
            
            document.getElementById('statsInfo').innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center p-4 bg-blue-50 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600">${totalDays}</div>
                        <div class="text-sm text-gray-600">ç·ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ—¥æ•°</div>
                    </div>
                    <div class="text-center p-4 bg-green-50 rounded-lg">
                        <div class="text-2xl font-bold text-green-600">${totalWorkouts}</div>
                        <div class="text-sm text-gray-600">å®Œäº†ã—ãŸç¨®ç›®æ•°</div>
                    </div>
                    <div class="text-center p-4 bg-purple-50 rounded-lg">
                        <div class="text-2xl font-bold text-purple-600">${totalSets}</div>
                        <div class="text-sm text-gray-600">ç·ã‚»ãƒƒãƒˆæ•°</div>
                    </div>
                    <div class="text-center p-4 bg-orange-50 rounded-lg">
                        <div class="text-2xl font-bold text-orange-600">${avgWeight}kg</div>
                        <div class="text-sm text-gray-600">å¹³å‡é‡é‡</div>
                    </div>
                </div>
            `;
        }

        function createWeightChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            const dates = Object.keys(trainingHistory).sort().slice(-30); // Last 30 days
            
            if (dates.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            const datasets = exercises.map((exercise, index) => {
                const colors = ['#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6', '#06B6D4', '#84CC16'];
                return {
                    label: exercise.name,
                    data: dates.map(date => trainingHistory[date][exercise.name].weight),
                    borderColor: colors[index % colors.length],
                    backgroundColor: colors[index % colors.length] + '20',
                    tension: 0.1
                };
            });
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates.map(date => new Date(date).toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' })),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'é‡é‡ (kg)'
                            }
                        }
                    }
                }
            });
        }

        function createFrequencyChart() {
            const ctx = document.getElementById('frequencyChart').getContext('2d');
            const monthlyData = {};
            
            Object.keys(trainingHistory).forEach(date => {
                const month = date.substring(0, 7); // YYYY-MM
                if (!monthlyData[month]) monthlyData[month] = 0;
                monthlyData[month]++;
            });
            
            const months = Object.keys(monthlyData).sort();
            const counts = months.map(month => monthlyData[month]);
            
            if (months.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months.map(month => {
                        const [year, monthNum] = month.split('-');
                        return `${year}å¹´${monthNum}æœˆ`;
                    }),
                    datasets: [{
                        label: 'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å›æ•°',
                        data: counts,
                        backgroundColor: '#3B82F6',
                        borderColor: '#2563EB',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'å›æ•°'
                            }
                        }
                    }
                }
            });
        }

        function createBodyPartChart() {
            const ctx = document.getElementById('bodyPartChart').getContext('2d');
            const bodyPartStats = {};
            
            exercises.forEach(exercise => {
                bodyPartStats[exercise.bodyPart] = { completed: 0, total: 0 };
            });
            
            Object.values(trainingHistory).forEach(dayData => {
                exercises.forEach(exercise => {
                    const exerciseData = dayData[exercise.name];
                    bodyPartStats[exercise.bodyPart].total++;
                    if (exerciseData.completed) {
                        bodyPartStats[exercise.bodyPart].completed++;
                    }
                });
            });
            
            const bodyParts = Object.keys(bodyPartStats);
            const completionRates = bodyParts.map(bodyPart => {
                const stats = bodyPartStats[bodyPart];
                return stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0;
            });
            
            if (bodyParts.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.font = '16px Arial';
                ctx.fillStyle = '#666';
                ctx.textAlign = 'center';
                ctx.fillText('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: bodyParts,
                    datasets: [{
                        data: completionRates,
                        backgroundColor: [
                            '#3B82F6', '#EF4444', '#10B981', '#F59E0B', 
                            '#8B5CF6', '#06B6D4', '#84CC16'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
